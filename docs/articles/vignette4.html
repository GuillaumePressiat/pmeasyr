<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valoriser les rsa • pmeasyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Valoriser les rsa">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pmeasyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette1.html">pmeasyr</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Flux d'import avec pmeasyr</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Vers la database avec pmeasyr</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Valoriser les rsa</a>
    </li>
    <li>
      <a href="../articles/vignette5.html">Analyser les données</a>
    </li>
    <li>
      <a href="../articles/vignette6.html">Valoriser les rum</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GuillaumePressiat/pmeasyr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Valoriser les rsa</h1>
                        <h4 data-toc-skip class="author">Guillaume
Pressiat</h4>
            
            <h4 data-toc-skip class="date">04/03/2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GuillaumePressiat/pmeasyr/blob/HEAD/vignettes/vignette4.Rmd" class="external-link"><code>vignettes/vignette4.Rmd</code></a></small>
      <div class="hidden name"><code>vignette4.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guillaumepressiatgithub.io/pmeasyr/" class="external-link">pmeasyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="préparer-les-tables-nécessaires">Préparer les tables nécessaires<a class="anchor" aria-label="anchor" href="#pr%C3%A9parer-les-tables-n%C3%A9cessaires"></a>
</h2>
<p>Il faut au moins disposer des rsa et des données anohosp. Pour
valoriser les suppléments, les tables porg, pie et diap sont aussi
nécessaires.</p>
<p>Deux possibilités pour préparer les données rsa et ano afin de
calculer la valorisation : les importer spécifiquement, ou les collecter
depuis une base de données, voir pour cela éventuellement les fonctions
autour des bases de données dans <code>pmeasyr</code>.</p>
<div class="section level3">
<h3 id="import-avec-pmeasyr-et-noyau">Import avec pmeasyr et noyau<a class="anchor" aria-label="anchor" href="#import-avec-pmeasyr-et-noyau"></a>
</h3>
<p>Ici, on utilise les fonctions <code>vvr_rsa</code> et
<code>vvr_ano_mco</code> pour importer les données depuis les fichiers
bruts du <em>out</em> et sélectionner les variables dont nous avons
besoins.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guillaumepressiatgithub.io/pmeasyr/" class="external-link">pmeasyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/noyau_pmeasyr.html">noyau_pmeasyr</a></span><span class="op">(</span></span>
<span>  finess <span class="op">=</span> <span class="st">'750100042'</span>,</span>
<span>  annee  <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  mois   <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  path   <span class="op">=</span> <span class="st">'~/Documents/data/mco'</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lib <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  tolower_names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p</span></span>
<span></span>
<span><span class="fu"><a href="../reference/adezip.html">adezip</a></span><span class="op">(</span><span class="va">p</span>, type <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vrsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vvr_rsa.html">vvr_rsa</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">vano</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vvr_ano_mco.html">vvr_ano_mco</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p>Cela produit deux tables <code>vrsa</code> et <code>vano</code>.</p>
</div>
<div class="section level3">
<h3 id="collecte-des-données-depuis-une-db">Collecte des données depuis une db<a class="anchor" aria-label="anchor" href="#collecte-des-donn%C3%A9es-depuis-une-db"></a>
</h3>
<p>Autre possibilité donc, le recours à une base de données où les
tables préexistent, ici, on les collecte en ne sélectionnant que les
variables utiles.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MonetDBLite</span><span class="op">)</span></span>
<span><span class="va">dbdir</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/data/monetdb"</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">src_monetdblite</span><span class="op">(</span><span class="va">dbdir</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vrsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vvr_rsa.html">vvr_rsa</a></span><span class="op">(</span><span class="va">con</span>, <span class="fl">18</span><span class="op">)</span></span>
<span><span class="va">vano</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vvr_ano_mco.html">vvr_ano_mco</a></span><span class="op">(</span><span class="va">con</span>,  <span class="fl">18</span><span class="op">)</span></span></code></pre></div>
<p>Cela produit de manière identique deux tables <code>vrsa</code> et
<code>vano</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="récupérer-les-tarifs-ghs-et-suppléments">Récupérer les tarifs GHS et suppléments<a class="anchor" aria-label="anchor" href="#r%C3%A9cup%C3%A9rer-les-tarifs-ghs-et-suppl%C3%A9ments"></a>
</h2>
<p>Pour valoriser les séjours, nous avons besoin des tarifs officiels.
Comme d’autres tables référentiels classiques du PMSI, on peut trouver
ces informations tarifaires pour les établissements ex-DGF dans le
package <a href="https://github.com/GuillaumePressiat/nomensland" class="external-link">nomensland</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_github('GuillaumePressiat/nomensland')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guillaumepressiat.github.io/nomensland/" class="external-link">nomensland</a></span><span class="op">)</span></span></code></pre></div>
<p>Il reste possible d’utiliser des tables tarifs et suppléments
provenant d’une autre source, mais cela nécessite d’avoir les mêmes noms
de colonnes que dans les tables de nomensland.</p>
<p>Charger ce package donne accès aux fonctions <code>get_table</code>
et <code>get_dictionnaire_tables</code>.</p>
</div>
<div class="section level2">
<h2 id="valoriser-les-rsa">Valoriser les rsa<a class="anchor" aria-label="anchor" href="#valoriser-les-rsa"></a>
</h2>
<p><strong>Nous ne tenons pas compte de la rubrique “minoration
forfaitaire liste en SUS” volontairement car cela nécessite de maintenir
la liste des MO en SUS pour 2016 et 2017</strong>.</p>
<div class="section level3">
<h3 id="traitement-des-rsa-transmis-hors-période-voir-tableau-rtp">Traitement des RSA transmis hors période (voir tableau RTP)<a class="anchor" aria-label="anchor" href="#traitement-des-rsa-transmis-hors-p%C3%A9riode-voir-tableau-rtp"></a>
</h3>
<p>Pour les RSA transmis hors période (année précédente, mois d’après,
souvent causés par des dossiers à cheval), on force le groupage en
erreur comme epmsi le fait. C’est fait avec la fonction
<code>vvr_rsa_hors_periode</code> :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vrsa</span> <span class="op">&lt;-</span> <span class="va">vrsa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/vvr_rsa_hors_periode.html">vvr_rsa_hors_periode</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">annee</span><span class="op">)</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html" class="external-link">str_pad</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">mois</span>, <span class="fl">2</span>, <span class="st">"left"</span>, <span class="st">'0'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cas-dune-valorisation-base-extrême-haut---extrême-bas">Cas d’une valorisation base + Extrême haut - Extrême bas<a class="anchor" aria-label="anchor" href="#cas-dune-valorisation-base-extr%C3%AAme-haut---extr%C3%AAme-bas"></a>
</h3>
<p>Ici, on se concentre sur la valorisation dite BEE pour “Base +
Extrême haut - Extrême bas”. En effet par défaut le paramètre
<code>bee</code> est à <code>TRUE</code> dans l’appel de fonction, et
les tables vano, porg et diap sont renseignés à vide.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Importer les tarifs GHS</span></span>
<span><span class="va">tarifs_ghs</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="fu"><a href="https://guillaumepressiat.github.io/nomensland/reference/get_table.html" class="external-link">get_table</a></span><span class="op">(</span><span class="st">'tarifs_mco_ghs'</span><span class="op">)</span>, <span class="va">ghs</span>, <span class="va">anseqta</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vvr_mco.html">vvr_mco</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/vvr_ghs_supp.html">vvr_ghs_supp</a></span><span class="op">(</span>rsa <span class="op">=</span> <span class="va">vrsa</span>, ano <span class="op">=</span>  <span class="va">vano</span>, tarifs <span class="op">=</span> <span class="va">tarifs_ghs</span>, cgeo <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/vvr_mco_sv.html">vvr_mco_sv</a></span><span class="op">(</span><span class="va">vrsa</span>, <span class="va">vano</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>La table <code>resu</code> contient une ligne par rsa avec les
variables suivantes :</p>
<pre><code><span><span class="va">cle_rsa</span></span>
<span><span class="va">rec_totale</span></span>
<span><span class="va">rec_base</span></span>
<span><span class="va">rec_exb</span></span>
<span><span class="va">rec_exh</span></span>
<span><span class="va">rec_bee</span></span>
<span><span class="va">type_fin</span></span>
<span><span class="va">typvidhosp</span></span></code></pre>
<p>On peut libeller ces variables en faisant appel à la fonction
<code>vvr_libelles_valo</code>, voir ci-dessous.</p>
</div>
<div class="section level3">
<h3 id="cas-dune-valorisation-base-extrême-haut---extrême-bas-suppléments">Cas d’une valorisation base + Extrême haut - Extrême bas +
suppléments<a class="anchor" aria-label="anchor" href="#cas-dune-valorisation-base-extr%C3%AAme-haut---extr%C3%AAme-bas-suppl%C3%A9ments"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Importer les tarifs des suppléments</span></span>
<span><span class="va">tarifs_supp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://guillaumepressiat.github.io/nomensland/reference/get_table.html" class="external-link">get_table</a></span><span class="op">(</span><span class="st">'tarifs_mco_supplements'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="fu">tidyr</span><span class="fu">::</span><span class="va"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span>, <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">cgeo</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vvr_mco.html">vvr_mco</a></span><span class="op">(</span></span>
<span><span class="fu"><a href="../reference/vvr_ghs_supp.html">vvr_ghs_supp</a></span><span class="op">(</span>rsa <span class="op">=</span> <span class="va">vrsa</span>, </span>
<span>             tarifs <span class="op">=</span> <span class="va">tarifs_ghs</span>, </span>
<span>             supplements <span class="op">=</span>  <span class="va">tarifs_supp</span>, </span>
<span>             ano <span class="op">=</span> <span class="va">vano</span>, </span>
<span>             porg <span class="op">=</span> <span class="fu"><a href="../reference/ipo.html">ipo</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, </span>
<span>             diap <span class="op">=</span> <span class="fu"><a href="../reference/idiap.html">idiap</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, </span>
<span>             pie <span class="op">=</span> <span class="fu"><a href="../reference/ipie.html">ipie</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, </span>
<span>             mo <span class="op">=</span> <span class="fu"><a href="../reference/imed_mco.html">imed_mco</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, </span>
<span>             full <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             cgeo <span class="op">=</span> <span class="fl">1L</span>, </span>
<span>             prudent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>             bee <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span><span class="fu"><a href="../reference/vvr_mco_sv.html">vvr_mco_sv</a></span><span class="op">(</span><span class="va">vrsa</span>, <span class="va">vano</span>, <span class="fu"><a href="../reference/ipo.html">ipo</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>La table <code>resu</code> contient une ligne par rsa avec les
variables suivantes :</p>
<pre><code><span><span class="va">cle_rsa</span></span>
<span><span class="va">moissor</span></span>
<span><span class="va">anseqta</span></span>
<span><span class="va">rec_totale</span></span>
<span><span class="va">rec_bee</span></span>
<span><span class="va">rec_base</span></span>
<span><span class="va">rec_exb</span></span>
<span><span class="va">rec_exh</span></span>
<span><span class="va">rec_rep</span></span>
<span><span class="va">rec_rea</span></span>
<span><span class="va">rec_stf</span></span>
<span><span class="va">rec_src</span></span>
<span><span class="va">rec_nn1</span></span>
<span><span class="va">rec_nn2</span></span>
<span><span class="va">rec_nn3</span></span>
<span><span class="va">rec_dialhosp</span></span>
<span><span class="va">rec_caishyp</span></span>
<span><span class="va">rec_aph</span></span>
<span><span class="va">rec_ant</span></span>
<span><span class="va">rec_rap</span></span>
<span><span class="va">rec_rehosp_ghm</span></span>
<span><span class="va">rec_rdt_tot</span></span>
<span><span class="va">rec_sdc</span></span>
<span><span class="va">rec_po_tot</span></span>
<span><span class="va">type_fin</span></span>
<span><span class="va">typvidhosp</span></span></code></pre>
<p>On peut libeller ces variables en faisant appel à la fonction
<code>vvr_libelles_valo</code>, voir ci-dessous.</p>
</div>
</div>
<div class="section level2">
<h2 id="générer-des-tableaux-type-epmsi-pour-comparaison-avec-les-valo-officielles">Générer des tableaux type epmsi pour comparaison avec les valo
officielles<a class="anchor" aria-label="anchor" href="#g%C3%A9n%C3%A9rer-des-tableaux-type-epmsi-pour-comparaison-avec-les-valo-officielles"></a>
</h2>
<p>Les variables présentes dans la table <code>resu</code> permettent à
la fois de dénombrer les séjours par type de valorisation, c’est-à-dire
:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">pmeasyr</span><span class="fu">::</span><span class="fu"><a href="../reference/vvr_libelles_valo.html">vvr_libelles_valo</a></span><span class="op">(</span><span class="st">'lib_type_sej'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="89%">
</colgroup>
<thead><tr class="header">
<th align="right">type_fin</th>
<th align="left">lib_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="left">Séjours valorisés</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Séjours en CM 90</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Séjours en prestation inter-établissement</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Séjours en GHS 9999</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Séjours avec pb de chainage (hors NN, rdth et PO)</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">Séjours avec pb de codage des variables bloquantes</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">Séjours en attente de décision sur les droits du
patient</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">Séjours non facturable à l’AM hors PO</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="left">Séjours avec PO sur patient arrivé décédé ou avec PO
non facturables à l’AM</td>
</tr>
</tbody>
</table>
<p>et de reproduire les rubriques de valorisation par type de
recette:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">pmeasyr</span><span class="fu">::</span><span class="fu"><a href="../reference/vvr_libelles_valo.html">vvr_libelles_valo</a></span><span class="op">(</span><span class="st">'lib_valo'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="13%">
<col width="16%">
<col width="69%">
</colgroup>
<thead><tr class="header">
<th align="right">ordre_epmsi</th>
<th align="left">var</th>
<th align="left">lib_valo</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">22</td>
<td align="left">rec_totale</td>
<td align="left">Valorisation 100% T2A globale</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rec_base</td>
<td align="left">Valorisation des GHS de base</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="left">rec_bee</td>
<td align="left">Valorisation base + exb + exh</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">rec_exb</td>
<td align="left">Valorisation extrême bas (à déduire)</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">rec_rehosp_ghm</td>
<td align="left">Valorisation séjours avec rehosp dans même GHM</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">rec_mino_sus</td>
<td align="left">Valorisation séjours avec minoration forfaitaire liste
en sus</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">rec_exh</td>
<td align="left">Valorisation journées extrême haut</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">rec_aph</td>
<td align="left">Valorisation actes GHS 9615 en Hospit.</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">rec_rap</td>
<td align="left">Valorisation suppléments radiothérapie pédiatrique</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">rec_ant</td>
<td align="left">Valorisation suppléments antepartum</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">rec_rdt_tot</td>
<td align="left">Valorisation actes RDTH en Hospit.</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">rec_rea</td>
<td align="left">Valorisation suppléments de réanimation</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rec_rep</td>
<td align="left">Valorisation suppléments de réa pédiatrique</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="left">rec_nn1</td>
<td align="left">Valorisation suppléments de néonat sans SI</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="left">rec_nn2</td>
<td align="left">Valorisation suppléments de néonat avec SI</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="left">rec_nn3</td>
<td align="left">Valorisation suppléments de réanimation néonat</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="left">rec_po_tot</td>
<td align="left">Valorisation prélévements d organe</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="left">rec_caishyp</td>
<td align="left">Valorisation des actes de caissons hyperbares en
sus</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="left">rec_dialhosp</td>
<td align="left">Valorisation suppléments de dialyse</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="left">rec_sdc</td>
<td align="left">Valorisation supplément défibrilateur cardiaque</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="left">rec_i04</td>
<td align="left">Valorisation suppléments Forfait Innovation I04</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="left">rec_ctc</td>
<td align="left">Valorisation suppléments Car-t Cells</td>
</tr>
<tr class="odd">
<td align="right">21</td>
<td align="left">rec_src</td>
<td align="left">Valorisation suppléments de surveillance continue</td>
</tr>
<tr class="even">
<td align="right">22</td>
<td align="left">rec_stf</td>
<td align="left">Valorisation suppléments de soins intensifs</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="types-de-vidhosp">Types de vidhosp<a class="anchor" aria-label="anchor" href="#types-de-vidhosp"></a>
</h3>
<p>La table resu contient également une colonne <code>typvidhosp</code>
qui correspond à un type de séjour, croisant plusieurs modalités
(factam, nouveaux-nés, séances, 0 jour, autres, etc.)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">pmeasyr</span><span class="fu">::</span><span class="fu"><a href="../reference/vvr_libelles_valo.html">vvr_libelles_valo</a></span><span class="op">(</span><span class="st">'lib_vidhosp'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">typvidhosp</th>
<th align="left">lib_typvidhosp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">0 : non pris en charge</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">3 : En attente des droits du patient</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">2 : En attente sur le taux de prise en charge</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">1 : Nouveau-né</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">1 : Radiothérapie</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">1 : Séances hors radiothérapie</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">1 : Durée de séjour = 0</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">1 : Autre type de séjour</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="séjours-valorisés">Séjours valorisés<a class="anchor" aria-label="anchor" href="#s%C3%A9jours-valoris%C3%A9s"></a>
</h3>
<p>Les séjours sont distribués et les recettes BR * coeffs sont sommées
en fonction du type de séjours (lib_type_sej).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/epmsi_mco_sv.html">epmsi_mco_sv</a></span><span class="op">(</span><span class="va">resu</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_if</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">is.numeric</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="récapitulation-activité---valorisation">Récapitulation activité - valorisation<a class="anchor" aria-label="anchor" href="#r%C3%A9capitulation-activit%C3%A9---valorisation"></a>
</h3>
<p>Les séjours sont distribués et les recettes BR * coeffs sont sommées
en fonction du type de séjours et du type de recette (lib_type_sej *
lib_valo).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/epmsi_mco_rav.html">epmsi_mco_rav</a></span><span class="op">(</span><span class="va">resu</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="connaître-en-détail-la-valorisation-des-séjours">Connaître en détail la valorisation des séjours<a class="anchor" aria-label="anchor" href="#conna%C3%AEtre-en-d%C3%A9tail-la-valorisation-des-s%C3%A9jours"></a>
</h2>
<p>Il est possible de garder toutes les variables intermédiaires du
calcul de valorisation, c’est le cas en précisant le paramètre
<code>full = TRUE</code> :</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vvr_mco.html">vvr_mco</a></span><span class="op">(</span></span>
<span><span class="fu"><a href="../reference/vvr_ghs_supp.html">vvr_ghs_supp</a></span><span class="op">(</span>rsa <span class="op">=</span> <span class="va">vrsa</span>, </span>
<span>             tarifs <span class="op">=</span> <span class="va">tarifs_ghs</span>, </span>
<span>             supplements <span class="op">=</span>  <span class="va">tarifs_supp</span>, </span>
<span>             ano <span class="op">=</span> <span class="va">vano</span>, </span>
<span>             porg <span class="op">=</span> <span class="fu"><a href="../reference/ipo.html">ipo</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, </span>
<span>             diap <span class="op">=</span> <span class="fu"><a href="../reference/idiap.html">idiap</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, </span>
<span>             pie <span class="op">=</span> <span class="fu"><a href="../reference/ipie.html">ipie</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, </span>
<span>             full <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             cgeo <span class="op">=</span> <span class="fl">1L</span>, </span>
<span>             prudent <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>             bee <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span><span class="fu"><a href="../reference/vvr_mco_sv.html">vvr_mco_sv</a></span><span class="op">(</span><span class="va">vrsa</span>, <span class="va">vano</span>, <span class="fu"><a href="../reference/ipo.html">ipo</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Dans ce cas, les variables suivantes deviennent accessibles au niveau
de chaque séjour :</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resu</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'rec_'</span><span class="op">)</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="va">rec_base</span></span>
<span><span class="va">rec_exh</span></span>
<span><span class="va">rec_exb</span></span>
<span><span class="va">rec_bee</span></span>
<span><span class="va">rec_totale</span></span>
<span><span class="va">rec_rep</span></span>
<span><span class="va">rec_rea</span></span>
<span><span class="va">rec_stf</span></span>
<span><span class="va">rec_src</span></span>
<span><span class="va">rec_nn1</span></span>
<span><span class="va">rec_nn2</span></span>
<span><span class="va">rec_nn3</span></span>
<span><span class="va">rec_hhs</span></span>
<span><span class="va">rec_edpahs</span></span>
<span><span class="va">rec_edpcahs</span></span>
<span><span class="va">rec_ehhs</span></span>
<span><span class="va">rec_dip</span></span>
<span><span class="va">rec_dialhosp</span></span>
<span><span class="va">rec_caishyp</span></span>
<span><span class="va">rec_aph</span></span>
<span><span class="va">rec_ant</span></span>
<span><span class="va">rec_rap</span></span>
<span><span class="va">rec_sdc</span></span>
<span><span class="va">rec_rdt5</span></span>
<span><span class="va">rec_prot</span></span>
<span><span class="va">rec_ict</span></span>
<span><span class="va">rec_cyb</span></span>
<span><span class="va">rec_gam</span></span>
<span><span class="va">rec_rcon1</span></span>
<span><span class="va">rec_rcon2</span></span>
<span><span class="va">rec_tciea</span></span>
<span><span class="va">rec_tcies</span></span>
<span><span class="va">rec_aie</span></span>
<span><span class="va">rec_rcon3</span></span>
<span><span class="va">rec_rdt_tot</span></span>
<span><span class="va">rec_poi</span></span>
<span><span class="va">rec_poii</span></span>
<span><span class="va">rec_poiii</span></span>
<span><span class="va">rec_poiv</span></span>
<span><span class="va">rec_pov</span></span>
<span><span class="va">rec_povi</span></span>
<span><span class="va">rec_povii</span></span>
<span><span class="va">rec_poviii</span></span>
<span><span class="va">rec_poix</span></span>
<span><span class="va">rec_poa</span></span>
<span><span class="va">rec_po_tot</span></span>
<span><span class="va">rec_rehosp_ghm</span></span>
<span><span class="va">rec_pie_src</span></span>
<span><span class="va">rec_pie_stf</span></span>
<span><span class="va">rec_pie_rea</span></span>
<span><span class="va">rec_pie_rep</span></span>
<span><span class="va">rec_pie_nn1</span></span>
<span><span class="va">rec_pie_nn2</span></span>
<span><span class="va">rec_pie_nn3</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="remarques-sur-le-mécanisme-de-valorisation">Remarques sur le mécanisme de valorisation<a class="anchor" aria-label="anchor" href="#remarques-sur-le-m%C3%A9canisme-de-valorisation"></a>
</h2>
<p>La valorisation des rsa est assez mécanique (c’est un programme), le
détail de ce mécanisme peut-être lu en regardant le code source de
<code>pmeasyr</code> (bien sûr, ce n’est pas le programme officiel). En
peu de mots, la logique est celle-ci :</p>
<ul>
<li>pour chaque GHS, un tarif de base, des tarifs extrème bas et extrème
haut en fonction de la durée de séjour. Cette partie est la plus
simple</li>
<li>pour chaque supplément, un tarif de supplément. Cette partie est
plus complexe car il y a de nombreux types de suppléments ; et chaque
type de supplément a sa propre mécanique</li>
</ul>
<p>Si cette mécanique vaut pour la grande majorité, on note quelques
exceptions, d’où les deux adaptations suivantes :</p>
<ul>
<li>en année séquentielle des tarifs 2017 et 2018, la borne basse du GHS
5907 déclenche une valorisation négative de certains séjours, voir <a href="https://applis.atih.sante.fr/agora/ago_action_theme.do?action=voir_sujet&amp;id_sujet=52026#166276" class="external-link">ici</a>,
agora, sujet 52026. Nous tenons compte de cette correction dans la
valorisation calculée dans R, ainsi que des monoRUM UHCD de 1 jour
considérés par l’ATIH comme l’équivalent de séjours 0 jour dans le
calcul du nombre de jours extrème bas. <em>Cette adaptation nécessite
d’intégrer l’information mono RUM UHCD lors de la valorisation, on
croise donc avec la table UM, ce qui allonge un peu le temps de
traitement</em>.</li>
<li>Fin 2018 et concernant uniquement l’année séquentielle des tarifs
2018, l’ATIH a introduit un switch de GHS pour les séjours présentant
une molécule de Kymriah ou de Yescarta, le GHS devient 8973. La solution
était provisoire dans l’attente d’un mode de financement spécifique des
séjours carT cells, mais nous avons inclus ce switch de GHS. Autrement
dit, le couple GHM/GHS présent dans les RSA pour ces séjours ne
correspond pas au couple utilisé sur epmsi pour calculer la valorisation
réelle, celle présente dans VVS. <em>Cette adaptation nécessite
d’intégrer les mo/atu lors de la valorisation</em>.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Guillaume Pressiat, Namik Taright, Joris Muller, IM-APHP.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
